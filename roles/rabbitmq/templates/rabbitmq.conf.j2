# RabbitMQ Configuration File
# Generated by Ansible

## Network Configuration
listeners.tcp.default = {{ rabbitmq_tcp_port | default('5672') }}

## Management Plugin Configuration
management.tcp.port = {{ rabbitmq_management_port | default('15672') }}
management.tcp.ip = {{ rabbitmq_management_bind_ip | default('0.0.0.0') }}

## Security Configuration
loopback_users.guest = {{ rabbitmq_allow_guest_loopback | default('false') }}

## Logging Configuration
log.console = {{ rabbitmq_log_console | default('false') }}
log.console.level = {{ rabbitmq_log_level | default('info') }}
log.file = {{ rabbitmq_log_file | default('/var/log/rabbitmq/rabbit.log') }}
log.file.level = {{ rabbitmq_log_level | default('info') }}

## Memory Configuration
vm_memory_high_watermark.relative = {{ rabbitmq_memory_high_watermark | default('0.6') }}

## Disk Space Configuration
disk_free_limit.relative = {{ rabbitmq_disk_free_limit | default('1.0') }}

{% if rabbitmq_enable_tls | default(false) %}
## SSL/TLS Configuration
listeners.ssl.default = {{ rabbitmq_ssl_port | default('5671') }}
ssl_options.verify = {{ rabbitmq_ssl_verify | default('verify_peer') }}
ssl_options.fail_if_no_peer_cert = {{ rabbitmq_ssl_fail_if_no_peer_cert | default('true') }}
ssl_options.cacertfile = {{ rabbitmq_ssl_cacert_file | default('/etc/rabbitmq/ssl/ca_certificate.pem') }}
ssl_options.certfile = {{ rabbitmq_ssl_cert_file | default('/etc/rabbitmq/ssl/server_certificate.pem') }}
ssl_options.keyfile = {{ rabbitmq_ssl_key_file | default('/etc/rabbitmq/ssl/server_key.pem') }}

## Management SSL Configuration
management.ssl.port = {{ rabbitmq_management_ssl_port | default('15671') }}
management.ssl.cacertfile = {{ rabbitmq_ssl_cacert_file | default('/etc/rabbitmq/ssl/ca_certificate.pem') }}
management.ssl.certfile = {{ rabbitmq_ssl_cert_file | default('/etc/rabbitmq/ssl/server_certificate.pem') }}
management.ssl.keyfile = {{ rabbitmq_ssl_key_file | default('/etc/rabbitmq/ssl/server_key.pem') }}
{% endif %}

{% if rabbitmq_cluster_enabled | default(false) %}
## Clustering Configuration
cluster_formation.peer_discovery_backend = {{ rabbitmq_cluster_discovery_backend | default('rabbit_peer_discovery_classic_config') }}
{% if rabbitmq_cluster_nodes is defined %}
cluster_formation.classic_config.nodes.1 = {{ rabbitmq_cluster_nodes | join('@') }}
{% endif %}
cluster_formation.randomize_startup_delay_range.min = 0
cluster_formation.randomize_startup_delay_range.max = 2
{% endif %}

## Performance Tuning
channel_max = {{ rabbitmq_channel_max | default('2047') }}
connection_max = {{ rabbitmq_connection_max | default('65535') }}
heartbeat = {{ rabbitmq_heartbeat | default('60') }}

## Default User Configuration (will be overridden by user management)
default_user = {{ rabbitmq_admin_user | default('admin') }}
default_pass = {{ rabbitmq_admin_password | default('changeme') }}
default_user_tags.administrator = true
default_permissions.configure = .*
default_permissions.read = .*
default_permissions.write = .*